!function(t){"use strict";var i=function(i,e){return this.itemsContainerSelector=e.container,this.itemSelector=e.item,this.nextSelector=e.next,this.paginationSelector=e.pagination,this.$scrollContainer=i,this.$container=window===i.get(0)?t(document):i,this.defaultDelay=e.delay,this.negativeMargin=e.negativeMargin,this.nextUrl=null,this.isBound=!1,this.isPaused=!1,this.isInitialized=!1,this.jsXhr=!1,this.listeners={next:new IASCallbacks(t),load:new IASCallbacks(t),loaded:new IASCallbacks(t),render:new IASCallbacks(t),rendered:new IASCallbacks(t),scroll:new IASCallbacks(t),noneLeft:new IASCallbacks(t),ready:new IASCallbacks(t)},this.extensions=[],this.scrollHandler=function(){if(this.isBound&&!this.isPaused){var t=this.getCurrentScrollOffset(this.$scrollContainer),i=this.getScrollThreshold();-1!=i&&(this.fire("scroll",[t,i]),t>=i&&this.next())}},this.getItemsContainer=function(){return t(this.itemsContainerSelector,this.$container)},this.getLastItem=function(){return t(this.itemSelector,this.getItemsContainer().get(0)).last()},this.getFirstItem=function(){return t(this.itemSelector,this.getItemsContainer().get(0)).first()},this.getScrollThreshold=function(t){var i;return t=t||this.negativeMargin,t=t>=0?-1*t:t,i=this.getLastItem(),0===i.length?-1:i.offset().top+i.height()+t},this.getCurrentScrollOffset=function(t){var i=0,e=t.height();return i=window===t.get(0)?t.scrollTop():t.offset().top,-1==navigator.platform.indexOf("iPhone")&&-1==navigator.platform.indexOf("iPod")||(e+=80),i+e},this.getNextUrl=function(i){return i=i||this.$container,t(this.nextSelector,i).last().attr("href")},this.load=function(i,e,n){var s,r,o=this,h=[],a=+new Date;n=n||this.defaultDelay;var l={url:i};return o.fire("load",[l]),this.jsXhr=t.get(l.url,null,t.proxy(function(i){0===(s=t(this.itemsContainerSelector,i).eq(0)).length&&(s=t(i).filter(this.itemsContainerSelector).eq(0)),s&&s.find(this.itemSelector).each(function(){h.push(this)}),o.fire("loaded",[i,h]),e&&((r=+new Date-a)<n?setTimeout(function(){e.call(o,i,h)},n-r):e.call(o,i,h))},o),"html"),this.jsXhr},this.render=function(i,e){var n=this,s=this.getLastItem(),r=0,o=this.fire("render",[i]);o.done(function(){t(i).hide(),s.after(i),t(i).fadeIn(400,function(){++r<i.length||(n.fire("rendered",[i]),e&&e())})}),o.fail(function(){e&&e()})},this.hidePagination=function(){this.paginationSelector&&t(this.paginationSelector,this.$container).hide()},this.restorePagination=function(){this.paginationSelector&&t(this.paginationSelector,this.$container).show()},this.throttle=function(i,e){var n,s,r=0;return n=function(){function t(){r=+new Date,i.apply(n,o)}var n=this,o=arguments,h=+new Date-r;s?clearTimeout(s):t(),h>e?t():s=setTimeout(t,e)},t.guid&&(n.guid=i.guid=i.guid||t.guid++),n},this.fire=function(t,i){return this.listeners[t].fireWith(this,i)},this.pause=function(){this.isPaused=!0},this.resume=function(){this.isPaused=!1},this};i.prototype.initialize=function(){if(this.isInitialized)return!1;var t=!!("onscroll"in this.$scrollContainer.get(0)),i=this.getCurrentScrollOffset(this.$scrollContainer),e=this.getScrollThreshold();return!!t&&(this.hidePagination(),this.bind(),this.nextUrl=this.getNextUrl(),i>=e?(this.next(),this.one("rendered",function(){this.isInitialized=!0,this.fire("ready")})):(this.isInitialized=!0,this.fire("ready")),this)},i.prototype.reinitialize=function(){this.isInitialized=!1,this.unbind(),this.initialize()},i.prototype.bind=function(){if(!this.isBound){this.$scrollContainer.on("scroll",t.proxy(this.throttle(this.scrollHandler,150),this));for(var i=0,e=this.extensions.length;i<e;i++)this.extensions[i].bind(this);this.isBound=!0,this.resume()}},i.prototype.unbind=function(){if(this.isBound){this.$scrollContainer.off("scroll",this.scrollHandler);for(var t=0,i=this.extensions.length;t<i;t++)void 0!==this.extensions[t].unbind&&this.extensions[t].unbind(this);this.isBound=!1}},i.prototype.destroy=function(){try{this.jsXhr.abort()}catch(t){}this.unbind(),this.$scrollContainer.data("ias",null)},i.prototype.on=function(i,e,n){if(void 0===this.listeners[i])throw new Error('There is no event called "'+i+'"');return n=n||0,this.listeners[i].add(t.proxy(e,this),n),this},i.prototype.one=function(t,i){var e=this,n=function(){e.off(t,i),e.off(t,n)};return this.on(t,i),this.on(t,n),this},i.prototype.off=function(t,i){if(void 0===this.listeners[t])throw new Error('There is no event called "'+t+'"');return this.listeners[t].remove(i),this},i.prototype.next=function(){var t=this.nextUrl,i=this;if(this.pause(),!t)return this.fire("noneLeft",[this.getLastItem()]),this.listeners.noneLeft.disable(),i.resume(),!1;var e=this.fire("next",[t]);return e.done(function(){i.load(t,function(t,e){i.render(e,function(){i.nextUrl=i.getNextUrl(t),i.resume()})})}),e.fail(function(){i.resume()}),!0},i.prototype.extension=function(t){if(void 0===t.bind)throw new Error('Extension doesn\'t have required method "bind"');return void 0!==t.initialize&&t.initialize(this),this.extensions.push(t),this.isBound&&this.reinitialize(),this},t.ias=function(i){var e=t(window);return e.ias.apply(e,arguments)},t.fn.ias=function(e){var n=Array.prototype.slice.call(arguments),s=this;return this.each(function(){var r=t(this),o=r.data("ias"),h=t.extend({},t.fn.ias.defaults,r.data(),"object"==typeof e&&e);if(o||(r.data("ias",o=new i(r,h)),t(document).ready(t.proxy(o.initialize,o))),"string"==typeof e){if("function"!=typeof o[e])throw new Error('There is no method called "'+e+'"');n.shift(),o[e].apply(o,n)}s=o}),s}}(jQuery);